import Head from 'next/head';
import { useEffect, useState } from 'react';
import MapViewer from '../components/MapViewer';
import { MapProvider } from 'react-map-gl';
import Header from '../components/Header';
import FlightTrackList from '../components/FlightTrackList';
import { FlightTrack, useFlightTracks } from '../api';
import AltitudeChart from '../components/AltitudeChart';

export default function Home() {
  const [selectedFlightTrack, setSelectedFlightTrack] = useState<FlightTrack | null>(null);
  const flightTracks = useFlightTracks();

  useEffect(() => {
    flightTracks.length > 0 ? setSelectedFlightTrack(flightTracks[0]) : setSelectedFlightTrack(null);
  }, [flightTracks]);

  const onSelectFlightTrack = (flightTrack: FlightTrack) => {
    setSelectedFlightTrack(flightTrack);
  };

  return (
    <>
      <Head>
        <title>IGC Viewer</title>
        <meta
          name='description'
          content='Web map application for viewing .igc files generated by glider flight trackers'
        />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <div className='flex h-screen flex-col'>
        <Header />
        <main className='flex flex-grow overflow-hidden bg-gray-50'>
          <FlightTrackList
            flightTracks={flightTracks}
            selectedFlightTrack={selectedFlightTrack}
            onSelectFlightTrack={onSelectFlightTrack}
          />
          <div className='flex flex-grow flex-col'>
            <MapProvider>
              <MapViewer selectedFlightTrack={selectedFlightTrack} />
            </MapProvider>
            <div className='max-w-96 h-96' style={{ height: 360 }}>
              <AltitudeChart selectedFlightTrack={selectedFlightTrack} />
            </div>
          </div>
        </main>
      </div>
    </>
  );
}
